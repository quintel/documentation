---
title: Molecules
---

The flows of molecules is modelled in ETEngine using a graph, separate from the energy graph. Nodes and edges for the molecule graph are stored in [graphs/molecules](https://github.com/quintel/etsource/tree/master/graphs/molecules).

## Initial calculation in Refinery

The molecule graph may have shares set on edges, just like the energy graph, but all nodes have a demand of zero.

The molecule nodes and edges are passed through Refinery as if part of the energy graph (although entirely disconnected from energy nodes) in order to set these shares and provide them to ETEngine. As a consequence, **molecule nodes must have unique keys** and cannot be named identically to their energy counterparts.

## Configuring ETSource

Demands in the molecule graph are based on demands calculated in the energy graph. For example, once we know how much electricity is generated by a gas power plant, it's easy to convert that number to a quantity of CO<sub>2</sub> emitted. If the gas plant emits 0.1g CO<sub>2</sub> per MJ of energy and the plant has an energy demand of 1PJ (one thousand million MJ), then the plant will produce 100T of CO<sub>2</sub>.

> CO<sub>2</sub> per MJ: 0.1g<br/>
> Electricity: 1,000,000,000 MJ<br/>
> CO<sub>2</sub> emitted: 100,000,000g (100T)

The `from_energy` attribute on molecule nodes is used to inform the node from which energy node to calculate the molecule flow, and which inputs or outputs to use.

### The `source` attribute

Every molecule node that receives a demand from an energy node must define a `source` attribute. This should match the key of an energy node where a demand is already known.

```
- from_energy.source = energy_power_combined_cycle_network_gas
```

### The `direction` attribute

By default, the molecule flow is determined by the demand of an energy node. For such cases, no `direction` attribute is needed. However, when used in combination with [the `conversion` attribute](#the-conversion-attribute), it may be desirable to determine the molecule demand by the input of output of certain carriers on the energy node.

If a node receives both coal and gas energy as inputs, but you only wish to use the coal input to calculate the molecule demand, you must set `direction` to "input":

```
- from_energy.direction = input
```

### The `conversion` attribute

This attribute configures how to convert the quantity of energy (in MJ) to a quantity of molecules. `conversion` can used with or without [the `direction` attribute](#the-direction-attribute).

#### With no `direction` value set

In this configuration, the demand in molecules is based on the total demand of the node. However, it would be uncommon for a quantity of energy in MJ to map directly (one-to-one) to a quantity of molecules. To convert from one to another, the `conversion` acts as a multiplier.

If molecule quantity is measured in kilograms and energy in MJ, the previous gas power plant example (0.1g CO<sub>2</sub> per MJ) would be:

```
- from_energy.conversion = 0.0001
```

#### With a `direction` set

When used in combination with a `direction`, `conversion` allows each input or output carrier to have a different conversion to the molecule quantity. The conversion should list each relevant input or output carrier, and the conversion. Any carrier not specified will not influence the quantity of molecules.

```
- from_energy.conversion.coal = 0.5
- from_energy.conversion.gas = 0.3
```

### Examples

#### Simple gas power plant

For every 1MJ of energy (node demand) on the gas power plant, 0.5kg of molecules will be set on the molecule graph:

```
- from_energy.source = energy_power_combined_cycle_network_gas
- from_energy.conversion = 0.5
```

:::info
The conversion does not care what molecule carrier is being set. There should be one molecule node for each type of molecule output by the energy node. For example, if the gas power plant has two molecule outputs – CO<sub>2</sub> and CO – then there would need to exist two molecule nodes; one for CO<sub>2</sub> and one for CO.
:::

#### Molecule flow varies depending on energy input carrier

For every 1MJ of electricity input 0.3kg of molecules will be set on the molecule graph. For every 1MJ of network gas, 0.5kg will be set:

```
- from_energy.source = space_heater_hybrid_heatpump
- from_energy.direction = input
- from_energy.conversion.electricity = 0.3
- from_energy.conversion.network_gas = 0.5
```

#### Molecule flow is based on energy output

For every 1MJ of useable heat output, 0.25kg of molecules will be set on the molecule graph:

```
- from_energy.source = industry_aluminium_burner_network_gas
- from_energy.direction = output
- from_energy.conversion.useable_heat = 0.25
```
